<page-header></page-header>
<div fxLayout="row wrap" class=" ">
  <div fxFlex="100" fxFlex.lt-sm="100" class=" ">
    <mat-accordion>
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'briefcase.title' | translate }}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="form-field-full">
          <div fxLayout="row wrap" fxLayoutGap="20px grid">
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{ 'buyTicket.ticket' | translate }}</mat-label>
                  <mtx-select [items]="listTicketPriceTypes" bindLabel="value" bindValue="code" [multiple]="false"
                    [(ngModel)]="this.searchModel.servicePlanTypeId" [notFoundText]="'common.notFound' | translate"
                    [searchable]="listTicketPriceTypes?.length>10">
                  </mtx-select>
                </mat-form-field>
              </section>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{ 'pricelist.scope' | translate }}</mat-label>
                  <mat-select [(ngModel)]="searchModel.scope">
                    <mat-option [value]="">{{ 'common.default-select' | translate }}</mat-option>
                    <ng-container *ngFor="let scope of listScope">
                      <mat-option [value]="scope.value">{{scope.label}}</mat-option>
                    </ng-container>
                  </mat-select>
                  <button *ngIf="searchModel.scope" matSuffix mat-icon-button type="button" class="btn-clear-drop"
                    (click)="searchModel.scope=null; $event.stopPropagation()">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </section>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{'vehicle.groupTypeVehicleFee' |translate}}</mat-label>
                  <mtx-select [items]="listVehicleType" bindLabel="value" bindValue="code" [multiple]="false"
                    [(ngModel)]="this.searchModel.vehicleGroupId" [notFoundText]="'common.notFound' | translate"
                    [searchable]="listVehicleType?.length>10">
                  </mtx-select>
                </mat-form-field>
              </section>
            </div>
          </div>
          <div fxLayout="row wrap" fxLayoutGap="20px grid">
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{ 'policy.route' | translate }}</mat-label>
                  <mtx-select [items]="listRoutes" bindLabel="name" bindValue="id" [multiple]="false"
                    [(ngModel)]="this.searchModel.routeId" [notFoundText]="'common.notFound' | translate"
                    [searchable]="listRoutes?.length>10">
                  </mtx-select>
                </mat-form-field>
              </section>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{ 'buyTicket.distance_type' | translate }}</mat-label>
                  <mtx-select [items]="listStages" bindLabel="name" bindValue="id" [multiple]="false" appendTo="body"
                    [(ngModel)]="this.searchModel.stageId" [notFoundText]="'common.notFound' | translate"
                    [searchable]="listStages?.length>10">
                  </mtx-select>
                </mat-form-field>
              </section>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{ 'contract.billing.station' | translate }}</mat-label>
                  <mtx-select [items]="listStationOpen" bindLabel="value" bindValue="code" [multiple]="false"
                    appendTo="body" [(ngModel)]="this.searchModel.stationId"
                    [notFoundText]="'common.notFound' | translate" [searchable]="listStationOpen?.length>10">
                  </mtx-select>
                </mat-form-field>
              </section>
            </div>
          </div>
          <div fxLayout="row wrap" fxLayoutGap="20px grid">
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <!-- Ngày tạo: từ ngày - đến ngày -->
              <mat-form-field class="example-form-field" appearance="outline">
                <mat-label>{{'special-vehicle.createDateFrom'| translate}}</mat-label>
                <mat-date-range-input [rangePicker]="createDatePicker" [comparisonStart]="createDateFrom"
                  [comparisonEnd]="createDateTo" (click)="createDatePicker.open()">
                  <input matStartDate maskDate placeholder="{{ 'common.fromDate' | translate }}"
                    [(ngModel)]="createDateFrom" #createDateFromId>
                  <input matEndDate maskDate placeholder="{{ 'common.endDate' | translate }}" [(ngModel)]="createDateTo"
                    #createDateToId>
                </mat-date-range-input>
                <button mat-button *ngIf="createDateFromId.value|| createDateToId.value" matSuffix mat-icon-button
                  aria-label="Clear" (click)="this.createDateFrom = null ;this.createDateTo = null;"
                  class="showclearDate" type="button">
                  <mat-icon>close</mat-icon>
                </button>
                <mat-datepicker-toggle matSuffix [for]="createDatePicker"></mat-datepicker-toggle>
                <mat-date-range-picker #createDatePicker></mat-date-range-picker>
              </mat-form-field>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field class="example-form-field" appearance="outline">
                <mat-label>{{'special-vehicle.approvalDateFrom'| translate}}</mat-label>
                <mat-date-range-input [rangePicker]="approveDatePicker" [comparisonStart]="approveDateFrom"
                  [comparisonEnd]="approveDateTo" (click)="approveDatePicker.open()">
                  <input matStartDate maskDate placeholder="{{ 'common.fromDate' | translate }}"
                    [(ngModel)]="approveDateFrom" #approveDateFromId>
                  <input matEndDate maskDate placeholder="{{ 'common.endDate' | translate }}"
                    [(ngModel)]="approveDateTo" #approveDateToId>
                </mat-date-range-input>
                <button mat-button *ngIf="approveDateFromId.value|| approveDateToId.value" matSuffix mat-icon-button
                  aria-label="Clear" (click)="this.approveDateFrom = null ;this.approveDateTo = null;"
                  class="showclearDate" type="button">
                  <mat-icon>close</mat-icon>
                </button>
                <mat-datepicker-toggle matSuffix [for]="approveDatePicker"></mat-datepicker-toggle>
                <mat-date-range-picker #approveDatePicker></mat-date-range-picker>
              </mat-form-field>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field class="example-form-field" appearance="outline">
                <mat-label>{{'special-vehicle.effectiveDateFrom'| translate}}</mat-label>
                <mat-date-range-input [rangePicker]="effectiveDatePicker" [comparisonStart]="startDateFrom"
                  [comparisonEnd]="endDateTo" (click)="effectiveDatePicker.open()">
                  <input matStartDate maskDate placeholder="{{ 'common.fromDate' | translate }}"
                    [(ngModel)]="startDateFrom" #startDateFromId>
                  <input matEndDate maskDate placeholder="{{ 'common.endDate' | translate }}" [(ngModel)]="endDateTo"
                    #endDateToId>
                </mat-date-range-input>
                <button mat-button *ngIf="startDateFromId.value || endDateToId.value" matSuffix mat-icon-button
                  aria-label="Clear" (click)="this.startDateFrom = null ;this.endDateTo = null;" class="showclearDate"
                  type="button">
                  <mat-icon>close</mat-icon>
                </button>
                <mat-datepicker-toggle matSuffix [for]="effectiveDatePicker"></mat-datepicker-toggle>
                <mat-date-range-picker #effectiveDatePicker></mat-date-range-picker>
              </mat-form-field>
            </div>
          </div>
          <div fxLayout="row wrap" fxLayoutGap="20px grid">
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <section>
                <mat-form-field appearance="outline" class="common-field">
                  <mat-label>{{ 'policy.statusHand' | translate }}</mat-label>
                  <mat-select [(ngModel)]="this.searchModel.status">
                    <mat-option [value]="">{{ 'common.default-select' | translate }}</mat-option>
                    <ng-container *ngFor="let status of listStatusHandle">
                      <mat-option [value]="status.value">{{status.label}}</mat-option>
                    </ng-container>
                  </mat-select>
                  <button *ngIf="searchModel.status" matSuffix mat-icon-button type="button" class="btn-clear-drop"
                    (click)="searchModel.status=null; $event.stopPropagation()">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </section>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline" class="common-field">
                <mat-label>{{ 'policy.ocsCode' | translate }}</mat-label>
                <input matInput [(ngModel)]="this.searchModel.ocsCode" />
                <button mat-button *ngIf="this.searchModel.ocsCode" matSuffix mat-icon-button aria-label="Clear"
                  (click)="this.searchModel.ocsCode = null" class="showclear" type="button">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline" floatLabel="always">
                <mat-label>{{'promotion.status.effect' | translate}}</mat-label>
                <input matInput style="height: 0px;" />
                <div fxLayout="row wrap" class="radio-stl">
                  <mat-checkbox [(ngModel)]="effect">{{
                        'special-vehicle.inEffect' | translate }}</mat-checkbox>
                  <mat-checkbox [(ngModel)]="expire" class="ml-70">{{
                        'special-vehicle.expire' | translate }}</mat-checkbox>
                </div>
              </mat-form-field>
            </div>
          </div>
          <div class="container" fxLayout fxLayout.xs="column" fxLayoutAlign="flex-end" fxLayoutGap="10px"
            fxLayoutGap.xs="0">
            <button mat-raised-button color="primary" type="submit" (click)="searchPriceList()">
              {{ 'common.button.search' | translate }}
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    <mat-card>
      <div class="container" fxLayout fxLayout.xs="column" fxLayoutAlign="flex-end" fxLayoutGap="10px"
        fxLayoutGap.xs="0" style="margin-right: 8px !important;">
        <button mat-raised-button color="primary" type="submit" (click)="createNewPrice()">
          {{ 'common.button.insert' | translate }}
        </button>
      </div>
      <crm-table [headerTable]="'policy.price_title'" [dataSource]="dataModel.dataSource" [isLoading]="isLoading"
        [isPaging]="true" [totalRecord]="totalRecord" [displayedColumns]="displayedColumns"
        (onPage)="onPageChangePricelist($event)" [pageIndex]="pageIndex">
        <ng-container *ngFor="let item of columns " [ngSwitch]="item.field">
          <ng-container matColumnDef="{{item.field}}" *ngSwitchDefault>
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row;">
              {{row[item.field]}}
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'orderNumber'">
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row;let i = dataIndex" class="ui-text-center">
              {{i+1 + this.searchModel.startrecord}}
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'fee'">
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row;" class="ui-text-center" style="text-align: right;">
              {{row[item.field] | number}}
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'ocsCode'">
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row;" class="ui-text-center" style="text-align: right;">
              {{row[item.field]}}
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'scope'">
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row;" class="ui-text-center" style="text-align: center;">
              {{row[item.field]}}
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'statusName'">
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row">
              <p *ngIf="row.status == statusApproved.CHODUYET" style="color:purple">{{row[item.field]}}</p>
              <p *ngIf="row.status == statusApproved.DADUYET" style="color:green">{{row[item.field]}}</p>
              <p *ngIf="row.status == statusApproved.DAHUYHIEULUC" style="color:black">{{row[item.field]}}</p>
              <p *ngIf="row.status == statusApproved.TUCHODUYET" style="color:red">{{row[item.field]}}</p>
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'checkbox'">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox (change)="masterToggle($event)" [(ngModel)]="dataModel.isAllSelected">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row" style="text-align: center;">
              <mat-checkbox (change)="checkItem(row)" [checked]="selection.isSelected(row)"
                [disabled]="row.status !=lstStatus.CHODUYET">
              </mat-checkbox>
            </td>
          </ng-container>
          <ng-container matColumnDef="{{item.field}}" *ngSwitchCase="'action'">
            <th mat-header-cell *matHeaderCellDef>{{item.i18n | translate}}</th>
            <td mat-cell *matCellDef="let row;">
              <button mat-icon-button color="primary" (click)="editRecord(row)"
                *ngIf="row.status!=lstStatus.DADUYET && row.status!=lstStatus.DAHUYHIEULUC">
                <mat-icon color="primary" svgIcon="ic_edit" matTooltip="{{'pricelist.tooltip.edit' | translate}}">
                </mat-icon>
              </button>
              <button mat-icon-button color="primary" (click)="deleteRecord(row)"
                *ngIf="row.status!=lstStatus.DADUYET && row.status!=lstStatus.DAHUYHIEULUC">
                <mat-icon color="primary" matTooltip="{{'pricelist.tooltip.delete' | translate}}">
                  delete
                </mat-icon>
              </button>
              <button mat-icon-button color="primary" (click)="cancelApproval(row)"
                *ngIf="row.status==lstStatus.DADUYET">
                <mat-icon color="primary" svgIcon="ic_minus"
                  matTooltip="{{'pricelist.tooltip.cancel-approval' | translate}}"></mat-icon>
              </button>
            </td>
          </ng-container>
        </ng-container>
      </crm-table>
      <div class="container" fxLayout fxLayout.xs="column" fxLayoutAlign="flex-end" fxLayoutGap="10px"
        fxLayoutGap.xs="0" style="margin-right: 8px;">
        <button mat-raised-button color="primary" (click)="approvalPrices()">
          {{ 'briefcase.approve' | translate }}
        </button>
        <button mat-raised-button color="primary" (click)="processDenial()">
          {{ 'briefcase.denial' | translate }}
        </button>
        <button mat-raised-button color="primary" (click)="exportFile()">
          {{ 'policy.exportExcel' | translate }}
        </button>
      </div>
    </mat-card>
  </div>
</div>
